import * as tslib_1 from "tslib";
import { ChangeDetectionStrategy, Component, Inject, Input, ViewChild, ElementRef, } from '@angular/core';
import { ADSENSE_TOKEN } from './adsense-config';
let AdsenseComponent = class AdsenseComponent {
    constructor(config) {
        this.config = config;
        /** can be manually set if you need all ads on a page to have same id page-xxx */
        this.adRegion = 'page-' + Math.floor(Math.random() * 10000) + 1;
    }
    ngOnInit() {
        const config = this.config;
        function use(source, defaultValue) {
            return config && source !== undefined ? source : defaultValue;
        }
        this.adClient = use(this.adClient, config.adClient);
        this.adSlot = use(this.adSlot, config.adSlot);
        this.adFormat = use(this.adFormat, config.adFormat || 'auto');
        this.display = use(this.display, config.display || 'block');
        this.width = use(this.width, config.width);
        this.height = use(this.height, config.height);
        this.layout = use(this.layout, config.layout);
        this.layoutKey = use(this.layoutKey, config.layoutKey);
        this.pageLevelAds = use(this.pageLevelAds, config.pageLevelAds);
        this.timeOutRetry = use(this.timeOutRetry, config.timeOutRetry || 200);
        this.adtest = use(this.adtest, config.adtest);
        this.fullWidthResponsive = use(this.fullWidthResponsive, config.fullWidthResponsive);
    }
    ngOnDestroy() {
        const iframe = this.ins.nativeElement.querySelector('iframe');
        if (iframe && iframe.contentWindow) {
            iframe.src = 'about:blank';
            iframe.remove();
        }
    }
    /**
     * attempts to push the ad twice. Usually if one doesn't work the other
     * will depeding on if the browser has the adsense code cached and
     * if its the first page to be loaded
     */
    ngAfterViewInit() {
        const res = this.push();
        if (res instanceof TypeError) {
            setTimeout(() => this.push(), this.timeOutRetry);
        }
    }
    push() {
        const p = {};
        if (this.pageLevelAds) {
            p.google_ad_client = this.adClient;
            p.enable_page_level_ads = true;
        }
        try {
            const adsbygoogle = window.adsbygoogle;
            adsbygoogle.push(p);
            return true;
        }
        catch (e) {
            return e;
        }
    }
};
AdsenseComponent.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [ADSENSE_TOKEN,] }] }
];
tslib_1.__decorate([
    Input()
], AdsenseComponent.prototype, "adClient", void 0);
tslib_1.__decorate([
    Input()
], AdsenseComponent.prototype, "adSlot", void 0);
tslib_1.__decorate([
    Input()
], AdsenseComponent.prototype, "adFormat", void 0);
tslib_1.__decorate([
    Input()
], AdsenseComponent.prototype, "adRegion", void 0);
tslib_1.__decorate([
    Input()
], AdsenseComponent.prototype, "display", void 0);
tslib_1.__decorate([
    Input()
], AdsenseComponent.prototype, "width", void 0);
tslib_1.__decorate([
    Input()
], AdsenseComponent.prototype, "height", void 0);
tslib_1.__decorate([
    Input()
], AdsenseComponent.prototype, "layout", void 0);
tslib_1.__decorate([
    Input()
], AdsenseComponent.prototype, "layoutKey", void 0);
tslib_1.__decorate([
    Input()
], AdsenseComponent.prototype, "pageLevelAds", void 0);
tslib_1.__decorate([
    Input()
], AdsenseComponent.prototype, "timeOutRetry", void 0);
tslib_1.__decorate([
    Input()
], AdsenseComponent.prototype, "adtest", void 0);
tslib_1.__decorate([
    Input()
], AdsenseComponent.prototype, "fullWidthResponsive", void 0);
tslib_1.__decorate([
    Input()
], AdsenseComponent.prototype, "className", void 0);
tslib_1.__decorate([
    ViewChild('ins', { read: ElementRef, static: true })
], AdsenseComponent.prototype, "ins", void 0);
AdsenseComponent = tslib_1.__decorate([
    Component({
        selector: 'ng2-adsense,ng-adsense',
        template: `
  <ins #ins class="adsbygoogle {{ className }}"
    [style.display]="display"
    [style.width.px]="width"
    [style.height.px]="height"
    [attr.data-ad-client]="adClient"
    [attr.data-ad-slot]="adSlot"
    [attr.data-ad-format]="adFormat"
    [attr.data-ad-region]="adRegion"
    [attr.data-layout]="layout"
    [attr.data-adtest]="adtest"
    [attr.data-layout-key]="layoutKey"
    [attr.data-full-width-responsive]="fullWidthResponsive">
  </ins>
  `,
        changeDetection: ChangeDetectionStrategy.OnPush
    }),
    tslib_1.__param(0, Inject(ADSENSE_TOKEN))
], AdsenseComponent);
export { AdsenseComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRzZW5zZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZzItYWRzZW5zZS8iLCJzb3VyY2VzIjpbImFkc2Vuc2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBRUwsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxNQUFNLEVBQ04sS0FBSyxFQUdMLFNBQVMsRUFDVCxVQUFVLEdBQ1gsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLGFBQWEsRUFBaUIsTUFBTSxrQkFBa0IsQ0FBQztBQXFCaEUsSUFBYSxnQkFBZ0IsR0FBN0IsTUFBYSxnQkFBZ0I7SUFnQzNCLFlBQ2lDLE1BQXFCO1FBQXJCLFdBQU0sR0FBTixNQUFNLENBQWU7UUEzQnRELGlGQUFpRjtRQUN4RSxhQUFRLEdBQUcsT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQTJCaEUsQ0FBQztJQUVMLFFBQVE7UUFDTixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQzNCLFNBQVMsR0FBRyxDQUFJLE1BQVMsRUFBRSxZQUFlO1lBQ3hDLE9BQU8sTUFBTSxJQUFJLE1BQU0sS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDO1FBQ2hFLENBQUM7UUFDRCxJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNwRCxJQUFJLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxRQUFRLElBQUksTUFBTSxDQUFDLENBQUM7UUFDOUQsSUFBSSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsT0FBTyxJQUFJLE9BQU8sQ0FBQyxDQUFDO1FBQzVELElBQUksQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzNDLElBQUksQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzlDLElBQUksQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzlDLElBQUksQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3ZELElBQUksQ0FBQyxZQUFZLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2hFLElBQUksQ0FBQyxZQUFZLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsTUFBTSxDQUFDLFlBQVksSUFBSSxHQUFHLENBQUMsQ0FBQztRQUN2RSxJQUFJLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxNQUFNLENBQUMsbUJBQW1CLENBQUMsQ0FBQztJQUN2RixDQUFDO0lBQ0QsV0FBVztRQUNULE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM5RCxJQUFJLE1BQU0sSUFBSSxNQUFNLENBQUMsYUFBYSxFQUFFO1lBQ2xDLE1BQU0sQ0FBQyxHQUFHLEdBQUcsYUFBYSxDQUFDO1lBQzNCLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUNqQjtJQUNILENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsZUFBZTtRQUNiLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUN4QixJQUFJLEdBQUcsWUFBWSxTQUFTLEVBQUU7WUFDNUIsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7U0FDbEQ7SUFDSCxDQUFDO0lBRUQsSUFBSTtRQUNGLE1BQU0sQ0FBQyxHQUFRLEVBQUUsQ0FBQztRQUNsQixJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDckIsQ0FBQyxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7WUFDbkMsQ0FBQyxDQUFDLHFCQUFxQixHQUFHLElBQUksQ0FBQztTQUNoQztRQUNELElBQUk7WUFDRixNQUFNLFdBQVcsR0FBSSxNQUFjLENBQUMsV0FBVyxDQUFDO1lBQ2hELFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEIsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ1YsT0FBTyxDQUFDLENBQUM7U0FDVjtJQUNILENBQUM7Q0FDRixDQUFBOzs0Q0F2REksTUFBTSxTQUFDLGFBQWE7O0FBL0JkO0lBQVIsS0FBSyxFQUFFO2tEQUFrQjtBQUVqQjtJQUFSLEtBQUssRUFBRTtnREFBeUI7QUFDeEI7SUFBUixLQUFLLEVBQUU7a0RBQWtCO0FBRWpCO0lBQVIsS0FBSyxFQUFFO2tEQUE0RDtBQUUzRDtJQUFSLEtBQUssRUFBRTtpREFBaUI7QUFFaEI7SUFBUixLQUFLLEVBQUU7K0NBQWU7QUFFZDtJQUFSLEtBQUssRUFBRTtnREFBZ0I7QUFFZjtJQUFSLEtBQUssRUFBRTtnREFBZ0I7QUFFZjtJQUFSLEtBQUssRUFBRTttREFBbUI7QUFFbEI7SUFBUixLQUFLLEVBQUU7c0RBQXVCO0FBRXRCO0lBQVIsS0FBSyxFQUFFO3NEQUFzQjtBQUVyQjtJQUFSLEtBQUssRUFBRTtnREFBZ0I7QUFFZjtJQUFSLEtBQUssRUFBRTs2REFBOEI7QUFJN0I7SUFBUixLQUFLLEVBQUU7bURBQW1CO0FBQzJCO0lBQXJELFNBQVMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQzs2Q0FBVTtBQTlCcEQsZ0JBQWdCO0lBbkI1QixTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsd0JBQXdCO1FBQ2xDLFFBQVEsRUFBRTs7Ozs7Ozs7Ozs7Ozs7R0FjVDtRQUNELGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO0tBQ2hELENBQUM7SUFrQ0csbUJBQUEsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFBO0dBakNiLGdCQUFnQixDQXdGNUI7U0F4RlksZ0JBQWdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENvbXBvbmVudCxcbiAgSW5qZWN0LFxuICBJbnB1dCxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIFZpZXdDaGlsZCxcbiAgRWxlbWVudFJlZixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IEFEU0VOU0VfVE9LRU4sIEFkc2Vuc2VDb25maWcgfSBmcm9tICcuL2Fkc2Vuc2UtY29uZmlnJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmcyLWFkc2Vuc2UsbmctYWRzZW5zZScsXG4gIHRlbXBsYXRlOiBgXG4gIDxpbnMgI2lucyBjbGFzcz1cImFkc2J5Z29vZ2xlIHt7IGNsYXNzTmFtZSB9fVwiXG4gICAgW3N0eWxlLmRpc3BsYXldPVwiZGlzcGxheVwiXG4gICAgW3N0eWxlLndpZHRoLnB4XT1cIndpZHRoXCJcbiAgICBbc3R5bGUuaGVpZ2h0LnB4XT1cImhlaWdodFwiXG4gICAgW2F0dHIuZGF0YS1hZC1jbGllbnRdPVwiYWRDbGllbnRcIlxuICAgIFthdHRyLmRhdGEtYWQtc2xvdF09XCJhZFNsb3RcIlxuICAgIFthdHRyLmRhdGEtYWQtZm9ybWF0XT1cImFkRm9ybWF0XCJcbiAgICBbYXR0ci5kYXRhLWFkLXJlZ2lvbl09XCJhZFJlZ2lvblwiXG4gICAgW2F0dHIuZGF0YS1sYXlvdXRdPVwibGF5b3V0XCJcbiAgICBbYXR0ci5kYXRhLWFkdGVzdF09XCJhZHRlc3RcIlxuICAgIFthdHRyLmRhdGEtbGF5b3V0LWtleV09XCJsYXlvdXRLZXlcIlxuICAgIFthdHRyLmRhdGEtZnVsbC13aWR0aC1yZXNwb25zaXZlXT1cImZ1bGxXaWR0aFJlc3BvbnNpdmVcIj5cbiAgPC9pbnM+XG4gIGAsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBBZHNlbnNlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICAvKiogYWRzZW5zZSBhY2NvdW50IGNhLXB1Yi1YWFhYWFhYWFhYWFhYWFhYICovXG4gIEBJbnB1dCgpIGFkQ2xpZW50OiBzdHJpbmc7XG4gIC8qKiBhZCBzbG90L251bWJlciAqL1xuICBASW5wdXQoKSBhZFNsb3Q6IHN0cmluZyB8IG51bWJlcjtcbiAgQElucHV0KCkgYWRGb3JtYXQ6IHN0cmluZztcbiAgLyoqIGNhbiBiZSBtYW51YWxseSBzZXQgaWYgeW91IG5lZWQgYWxsIGFkcyBvbiBhIHBhZ2UgdG8gaGF2ZSBzYW1lIGlkIHBhZ2UteHh4ICovXG4gIEBJbnB1dCgpIGFkUmVnaW9uID0gJ3BhZ2UtJyArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwKSArIDE7XG4gIC8qKiBpbnMgZWxlbWVudCBkaXNwbGF5IHN0eWxlICovXG4gIEBJbnB1dCgpIGRpc3BsYXk6IHN0cmluZztcbiAgLyoqIGlucyBlbGVtZW50IGhlaWdodCBpbiBweCAqL1xuICBASW5wdXQoKSB3aWR0aDogbnVtYmVyO1xuICAvKiogaW5zIGVsZW1lbnQgd2lkdGggaW4gcHggKi9cbiAgQElucHV0KCkgaGVpZ2h0OiBudW1iZXI7XG4gIC8qKiB1c2VkIGZvciBpbi1mZWVkIGFkcyAqL1xuICBASW5wdXQoKSBsYXlvdXQ6IHN0cmluZztcbiAgLyoqIHVzZWQgZm9yIGluLWZlZWQgYWRzICovXG4gIEBJbnB1dCgpIGxheW91dEtleTogc3RyaW5nO1xuICAvKiogZW5hYmxlIHBhZ2UtbGV2ZWwgYWRzICovXG4gIEBJbnB1dCgpIHBhZ2VMZXZlbEFkczogYm9vbGVhbjtcbiAgLyoqIG9uIGZpcnN0IGxvYWQgc29tZXRpbWVzIGFkc2Vuc2UgaXMgbm90IHJlYWR5ICovXG4gIEBJbnB1dCgpIHRpbWVPdXRSZXRyeTogbnVtYmVyO1xuICAvKiogc2V0cyB1cCBzb21lIHNvcnQgb2YgZ29vZ2xlIHRlc3QgYWQgKi9cbiAgQElucHV0KCkgYWR0ZXN0OiBzdHJpbmc7XG4gIC8qIHVzZWQgZm9yIGZsZXhpYmxlIGFkcyAqL1xuICBASW5wdXQoKSBmdWxsV2lkdGhSZXNwb25zaXZlOiBib29sZWFuO1xuICAvKipcbiAgICogY2xhc3NlcyBhcHBsaWVkIHRvIHRoZSBpbnMgZWxlbWVudFxuICAgKi9cbiAgQElucHV0KCkgY2xhc3NOYW1lOiBzdHJpbmc7XG4gIEBWaWV3Q2hpbGQoJ2lucycsIHsgcmVhZDogRWxlbWVudFJlZiwgc3RhdGljOiB0cnVlIH0pIGluczogYW55O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIEBJbmplY3QoQURTRU5TRV9UT0tFTikgcHJpdmF0ZSBjb25maWc6IEFkc2Vuc2VDb25maWcsXG4gICkgeyB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgY29uc3QgY29uZmlnID0gdGhpcy5jb25maWc7XG4gICAgZnVuY3Rpb24gdXNlPFQ+KHNvdXJjZTogVCwgZGVmYXVsdFZhbHVlOiBUKTogVCB7XG4gICAgICByZXR1cm4gY29uZmlnICYmIHNvdXJjZSAhPT0gdW5kZWZpbmVkID8gc291cmNlIDogZGVmYXVsdFZhbHVlO1xuICAgIH1cbiAgICB0aGlzLmFkQ2xpZW50ID0gdXNlKHRoaXMuYWRDbGllbnQsIGNvbmZpZy5hZENsaWVudCk7XG4gICAgdGhpcy5hZFNsb3QgPSB1c2UodGhpcy5hZFNsb3QsIGNvbmZpZy5hZFNsb3QpO1xuICAgIHRoaXMuYWRGb3JtYXQgPSB1c2UodGhpcy5hZEZvcm1hdCwgY29uZmlnLmFkRm9ybWF0IHx8ICdhdXRvJyk7XG4gICAgdGhpcy5kaXNwbGF5ID0gdXNlKHRoaXMuZGlzcGxheSwgY29uZmlnLmRpc3BsYXkgfHwgJ2Jsb2NrJyk7XG4gICAgdGhpcy53aWR0aCA9IHVzZSh0aGlzLndpZHRoLCBjb25maWcud2lkdGgpO1xuICAgIHRoaXMuaGVpZ2h0ID0gdXNlKHRoaXMuaGVpZ2h0LCBjb25maWcuaGVpZ2h0KTtcbiAgICB0aGlzLmxheW91dCA9IHVzZSh0aGlzLmxheW91dCwgY29uZmlnLmxheW91dCk7XG4gICAgdGhpcy5sYXlvdXRLZXkgPSB1c2UodGhpcy5sYXlvdXRLZXksIGNvbmZpZy5sYXlvdXRLZXkpO1xuICAgIHRoaXMucGFnZUxldmVsQWRzID0gdXNlKHRoaXMucGFnZUxldmVsQWRzLCBjb25maWcucGFnZUxldmVsQWRzKTtcbiAgICB0aGlzLnRpbWVPdXRSZXRyeSA9IHVzZSh0aGlzLnRpbWVPdXRSZXRyeSwgY29uZmlnLnRpbWVPdXRSZXRyeSB8fCAyMDApO1xuICAgIHRoaXMuYWR0ZXN0ID0gdXNlKHRoaXMuYWR0ZXN0LCBjb25maWcuYWR0ZXN0KTtcbiAgICB0aGlzLmZ1bGxXaWR0aFJlc3BvbnNpdmUgPSB1c2UodGhpcy5mdWxsV2lkdGhSZXNwb25zaXZlLCBjb25maWcuZnVsbFdpZHRoUmVzcG9uc2l2ZSk7XG4gIH1cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgY29uc3QgaWZyYW1lID0gdGhpcy5pbnMubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdpZnJhbWUnKTtcbiAgICBpZiAoaWZyYW1lICYmIGlmcmFtZS5jb250ZW50V2luZG93KSB7XG4gICAgICBpZnJhbWUuc3JjID0gJ2Fib3V0OmJsYW5rJztcbiAgICAgIGlmcmFtZS5yZW1vdmUoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogYXR0ZW1wdHMgdG8gcHVzaCB0aGUgYWQgdHdpY2UuIFVzdWFsbHkgaWYgb25lIGRvZXNuJ3Qgd29yayB0aGUgb3RoZXJcbiAgICogd2lsbCBkZXBlZGluZyBvbiBpZiB0aGUgYnJvd3NlciBoYXMgdGhlIGFkc2Vuc2UgY29kZSBjYWNoZWQgYW5kXG4gICAqIGlmIGl0cyB0aGUgZmlyc3QgcGFnZSB0byBiZSBsb2FkZWRcbiAgICovXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICBjb25zdCByZXMgPSB0aGlzLnB1c2goKTtcbiAgICBpZiAocmVzIGluc3RhbmNlb2YgVHlwZUVycm9yKSB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMucHVzaCgpLCB0aGlzLnRpbWVPdXRSZXRyeSk7XG4gICAgfVxuICB9XG5cbiAgcHVzaCgpIHtcbiAgICBjb25zdCBwOiBhbnkgPSB7fTtcbiAgICBpZiAodGhpcy5wYWdlTGV2ZWxBZHMpIHtcbiAgICAgIHAuZ29vZ2xlX2FkX2NsaWVudCA9IHRoaXMuYWRDbGllbnQ7XG4gICAgICBwLmVuYWJsZV9wYWdlX2xldmVsX2FkcyA9IHRydWU7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZHNieWdvb2dsZSA9ICh3aW5kb3cgYXMgYW55KS5hZHNieWdvb2dsZTtcbiAgICAgIGFkc2J5Z29vZ2xlLnB1c2gocCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gZTtcbiAgICB9XG4gIH1cbn1cblxuIl19